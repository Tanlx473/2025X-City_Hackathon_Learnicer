<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ç‰©ç†å¯è§†åŒ–é›†æˆæµ‹è¯•</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', SimHei, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .container {
      display: flex;
      gap: 20px;
    }
    
    .canvas-area {
      flex: 2;
    }
    
    canvas {
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
    
    .controls {
      margin-top: 10px;
    }
    
    .controls button {
      padding: 8px 15px;
      margin-right: 5px;
      cursor: pointer;
    }
    
    .steps-panel {
      flex: 1;
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      max-height: 600px;
      overflow-y: auto;
    }
    
    .step-item {
      background: white;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 3px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .step-item:hover {
      background: #e3f2fd;
    }
    
    .step-item.active {
      background: #2196f3;
      color: white;
    }
    
    .step-item h4 {
      margin: 0 0 5px 0;
    }
    
    .step-item p {
      margin: 0;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>ç‰©ç†é¢˜ç›®å¯è§†åŒ–æ¼”ç¤º</h1>
  
  <div class="container">
    <div class="canvas-area">
      <canvas id="physics-canvas" width="800" height="600"></canvas>
      
      <div class="controls">
        <button id="play-btn">â–¶ æ’­æ”¾</button>
        <button id="pause-btn">â¸ æš‚åœ</button>
        <button id="reset-btn">â® é‡ç½®</button>
        <button id="step-back">âª</button>
        <button id="step-forward">â©</button>
        
        <label>é€Ÿåº¦:
          <select id="speed-select">
            <option value="0.5">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="2">2x</option>
          </select>
        </label>
        
        <button id="export-btn">ğŸ“· å¯¼å‡ºå½“å‰å¸§</button>
      </div>
    </div>
    
    <div class="steps-panel" id="steps-panel">
      <h3>è§£é¢˜æ­¥éª¤</h3>
      <!-- æ­¥éª¤å°†åŠ¨æ€å¡«å…… -->
    </div>
  </div>
  
  <!-- å¼•å…¥æ‰€æœ‰è„šæœ¬ -->
  <script src="animation_base.js"></script>
  <script src="free_fall.js"></script>
  <script src="projectile_motion.js"></script>
  <script src="incline_plane.js"></script>
  <script src="circular_motion.js"></script>
  <script src="physics_visualizer.js"></script>
  
  <script>
    // æ¨¡æ‹Ÿåç«¯è¿”å›çš„æ•°æ®ï¼ˆå®é™…åº”ä»APIè·å–ï¼‰
    const mockBackendData = {
      problem_type: "mechanics",
      sub_type: "projectile_motion",
      description: "ä¸€å°çƒä»¥20m/sçš„åˆé€Ÿåº¦ä»åœ°é¢ä»¥45Â°è§’æ–œå‘ä¸ŠæŠ›å‡ºï¼Œæ±‚æœ€å¤§é«˜åº¦å’Œå°„ç¨‹ã€‚(g=9.8m/sÂ²)",
      
      parameters: {
        v0: 20,
        angle: 45,
        h0: 0,
        g: 9.8,
        mass: 1
      },
      
      solution_steps: [
        {
          step: 1,
          description: "åˆ†è§£åˆé€Ÿåº¦",
          formula: "vâ‚“ = vâ‚€Â·cos45Â° = 14.14 m/s, váµ§ = vâ‚€Â·sin45Â° = 14.14 m/s",
          animation_time: [0, 1]
        },
        {
          step: 2,
          description: "ç‰©ä½“ä¸Šå‡é˜¶æ®µ",
          formula: "æœ€é«˜ç‚¹æ—¶ váµ§ = 0",
          animation_time: [1, 1.44]
        },
        {
          step: 3,
          description: "è®¡ç®—æœ€å¤§é«˜åº¦",
          formula: "h_max = váµ§Â²/(2g) = 10.2 m",
          animation_time: [1.44, 1.5]
        },
        {
          step: 4,
          description: "ç‰©ä½“ä¸‹é™é˜¶æ®µ",
          formula: "váµ§ = gt",
          animation_time: [1.5, 2.88]
        },
        {
          step: 5,
          description: "è®¡ç®—å°„ç¨‹",
          formula: "R = vâ‚€Â²Â·sin(2Î¸)/g = 40.8 m",
          animation_time: [2.88, 3]
        }
      ]
    };
    
    // åˆå§‹åŒ–å¯è§†åŒ–å™¨
    const visualizer = new PhysicsVisualizer('physics-canvas');
    
    // åŠ è½½åŠ¨ç”»
    visualizer.loadAnimation(mockBackendData);
    
    // æ¸²æŸ“è§£é¢˜æ­¥éª¤
    function renderSteps(steps) {
      const panel = document.getElementById('steps-panel');
      steps.forEach((step, index) => {
        const div = document.createElement('div');
        div.className = 'step-item';
        div.id = `step-${index}`;
        div.innerHTML = `
          <h4>æ­¥éª¤${step.step}ï¼š${step.description}</h4>
          <p>${step.formula}</p>
        `;
        div.onclick = () => {
          visualizer.playStep(index);
          // é«˜äº®å½“å‰æ­¥éª¤
          document.querySelectorAll('.step-item').forEach(el => {
            el.classList.remove('active');
          });
          div.classList.add('active');
        };
        panel.appendChild(div);
      });
    }
    
    renderSteps(mockBackendData.solution_steps);
    
    // ç»‘å®šæ§åˆ¶æŒ‰é’®
    document.getElementById('play-btn').onclick = () => visualizer.play();
    document.getElementById('pause-btn').onclick = () => visualizer.pause();
    document.getElementById('reset-btn').onclick = () => visualizer.reset();
    document.getElementById('step-back').onclick = () => {
      if (visualizer.currentAnimation) {
        visualizer.currentAnimation.stepBackward();
      }
    };
    document.getElementById('step-forward').onclick = () => {
      if (visualizer.currentAnimation) {
        visualizer.currentAnimation.stepForward();
      }
    };
    
    document.getElementById('speed-select').onchange = function() {
      if (visualizer.currentAnimation) {
        visualizer.currentAnimation.setSpeed(parseFloat(this.value));
      }
    };
    
    document.getElementById('export-btn').onclick = () => {
      const dataURL = visualizer.exportFrame();
      const link = document.createElement('a');
      link.download = `physics_frame_${Date.now()}.png`;
      link.href = dataURL;
      link.click();
    };
    
    // ç›‘å¬åŠ¨ç”»äº‹ä»¶
    document.getElementById('physics-canvas').addEventListener('step:active', (e) => {
      console.log('æ¿€æ´»æ­¥éª¤:', e.detail.stepIndex);
    });
    
    // è‡ªåŠ¨æ’­æ”¾
    setTimeout(() => {
      visualizer.play();
    }, 1000);
  </script>
</body>
</html>