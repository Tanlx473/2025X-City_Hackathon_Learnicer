<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ç‰©ç†åŠ¨ç”»æœ€ç»ˆæµ‹è¯•</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js"></script>

  <style>
    body {
      font-family: 'Microsoft YaHei', SimHei, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .container {
      display: flex;  /* ä¿®æ”¹ï¼šæ–°å¢ flex å¸ƒå±€ */
    }
    
    .canvas-area {
      flex: 1;  /* ç”»å¸ƒå ä¸»è¦ç©ºé—´ */
      margin-right: 20px;  /* å³ä¾§é—´è· */
    }
    
    canvas {
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
    
    .controls {
      margin-top: 10px;
      margin-bottom: 20px;
    }
    
    .controls button {
      padding: 8px 15px;
      margin-right: 5px;
      cursor: pointer;
    }
    
    .sidebar {  /* æ–°å¢ï¼šå³ä¾§é¢æ¿ */
      width: 250px;
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
    }
    
    .sidebar h4 {
      margin: 0 0 10px 0;
    }
    
    .sidebar label {
      display: block;
      margin-bottom: 10px;
    }
    
    #physics-panel {
      margin-top: 20px;
      background: white;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    
    #physics-panel ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    #physics-panel li {
      margin-bottom: 5px;
      font-size: 14px;
    }
    
    #physics-panel strong {
      font-weight: bold;
    }
    
    /* æ–°å¢ï¼šé¢œè‰²åŒ¹é…çŸ¢é‡å›¾ */
    .color-vx { color: green; }
    .color-vy { color: orange; }
    .color-v { color: blue; }
    .color-g { color: red; }
    
    .steps-panel {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
    }
    
    .step-item {
      background: white;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 3px;
      line-height: 1.8;
    }
    
    .step-item h4 {
      margin: 0 0 10px 0;
      color: #2196f3;
    }
    
    .log-container {
      margin-top: 20px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 3px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>


</head>
<body>
  <h1>ç‰©ç†åŠ¨ç”»æœ€ç»ˆæµ‹è¯•</h1>
  
  <div class="container">  <!-- ä¿®æ”¹ï¼šæ–°å¢ container -->
    <div class="canvas-area">
      <canvas id="test-canvas" width="1000" height="700"></canvas>
      <div class="controls">
        <button id="play-btn">â–¶ æ’­æ”¾</button>
        <button id="pause-btn">â¸ æš‚åœ</button>
        <button id="reset-btn">â® é‡ç½®</button>
        <button id="export-btn">ğŸ“· å¯¼å‡ºå¸§</button>
        <label>å€é€Ÿ:
          <select id="speed-select">
            <option value="2">0.5x</option>
            <option value="1" selected>1x</option>
            <option value="0.5">2x</option>
          </select>
        </label>
        <button id="next-test-btn" style="margin-left: 20px; background: #4CAF50; color: white;">ä¸‹ä¸€ä¸ªæµ‹è¯•</button>
      </div>
    </div>
    
    <div class="sidebar">  <!-- æ–°å¢ï¼šå³ä¾§ sidebar -->
      <h4>æ˜¾ç¤ºé€‰é¡¹</h4>
      <label>
        <input type="checkbox" id="show-velocity-vectors" checked> é€Ÿåº¦çŸ¢é‡å›¾
      </label>
      <label>
        <input type="checkbox" id="show-force-diagram"> å—åŠ›åˆ†æå›¾
      </label>
      
      <div id="physics-panel">
        <p>å®æ—¶ç‰©ç†é‡ï¼š</p>
        <!-- è¿™é‡ŒåŠ¨æ€æ›´æ–° -->
      </div>
    </div>
  </div>
  
  <div class="steps-panel" id="steps-panel">
    <h3>è§£é¢˜æ­¥éª¤</h3>
    <p>ç‚¹å‡»"ä¸‹ä¸€ä¸ªæµ‹è¯•"å¼€å§‹</p>
  </div>
  
  <div class="log-container" id="log-container"></div>
  
  <!-- å¼•å…¥æ‰€æœ‰è„šæœ¬ -->
  <script src="animation_base.js"></script>
  <script src="free_fall.js"></script>
  <script src="projectile_motion.js"></script>
  <script src="uniform.js"></script>
  <script src="simulation_api.js"></script>
  <script src="uniform_acceleration.js"></script>
  <script src="uniform_circular.js"></script>
  
  <script>
    let currentAnimation;
    const canvas = document.getElementById('test-canvas');
    const velocityCheckbox = document.getElementById('show-velocity-vectors');
    const forceCheckbox = document.getElementById('show-force-diagram');
    const physicsPanel = document.getElementById('physics-panel');
    
    // æ¨¡æ‹Ÿä¸åŒæµ‹è¯•æ¡ˆä¾‹
    const testCases = [
      {
        description: 'è‡ªç”±è½ä½“',
        response: {
          animation_instructions: { type: 'free_fall' },
          parameters: { height: 5, g: 9.8, mass: 1, bounce: true, bounceLoss: 0.6 },
          solution_steps: [
            { title: 'æ­¥éª¤1ï¼šç¡®å®šåˆå§‹æ¡ä»¶', content: 'åˆå§‹é«˜åº¦ $$h_0 = 20\\text{ m}$$ï¼Œåˆé€Ÿåº¦ $$v_0 = 0$$ï¼Œé‡åŠ›åŠ é€Ÿåº¦ $$g = 9.8\\text{ m/s}^2$$' },
            { title: 'æ­¥éª¤2ï¼šè®¡ç®—é€Ÿåº¦', content: 'æ ¹æ®é€Ÿåº¦å…¬å¼ï¼š$$v = v_0 + gt = 0 + 9.8t = 9.8t\\text{ m/s}$$' },
            { title: 'æ­¥éª¤3ï¼šè®¡ç®—ä½ç½®', content: 'æ ¹æ®ä½ç§»å…¬å¼ï¼š$$h = h_0 - \\frac{1}{2}gt^2 = 20 - 4.9t^2\\text{ m}$$' },
            { title: 'æ­¥éª¤4ï¼šè½åœ°æ—¶é—´', content: 'ä»¤ $$h = 0$$ï¼Œå¾— $$t = \\sqrt{\\frac{2h_0}{g}} = \\sqrt{\\frac{40}{9.8}} \\approx 2.02\\text{ s}$$' }
          ]
        }
      },
      {
        description: 'æŠ›ä½“è¿åŠ¨',
        response: {
          animation_instructions: { type: 'projectile_motion' },
          parameters: { v0: 20, angle: 45, h0: 0, g: 9.8, mass: 1 },
          solution_steps: [
            { title: 'æ­¥éª¤1ï¼šåˆ†è§£åˆé€Ÿåº¦', content: 'æ°´å¹³åˆ†é‡ï¼š$$v_{x0} = v_0\\cos\\theta = 20\\cos45Â° = 14.14\\text{ m/s}$$<br>ç«–ç›´åˆ†é‡ï¼š$$v_{y0} = v_0\\sin\\theta = 20\\sin45Â° = 14.14\\text{ m/s}$$' },
            { title: 'æ­¥éª¤2ï¼šæœ€é«˜ç‚¹è®¡ç®—', content: 'æœ€é«˜ç‚¹æ—¶é—´ï¼š$$t_{max} = \\frac{v_{y0}}{g} = \\frac{14.14}{9.8} = 1.44\\text{ s}$$<br>æœ€å¤§é«˜åº¦ï¼š$$h_{max} = \\frac{v_{y0}^2}{2g} = \\frac{14.14^2}{19.6} = 10.2\\text{ m}$$' },
            { title: 'æ­¥éª¤3ï¼šé£è¡Œæ—¶é—´', content: 'æ€»é£è¡Œæ—¶é—´ï¼š$$t_{total} = \\frac{2v_{y0}}{g} = \\frac{2 \\times 14.14}{9.8} = 2.89\\text{ s}$$' },
            { title: 'æ­¥éª¤4ï¼šæ°´å¹³å°„ç¨‹', content: 'å°„ç¨‹ï¼š$$R = v_{x0} \\cdot t_{total} = 14.14 \\times 2.89 = 40.86\\text{ m}$$' }
          ]
        }
      },
      {
        description: 'ç«–ç›´ä¸ŠæŠ›',
        response: {
          animation_instructions: { type: 'vertical_throw' },
          parameters: { v0: 15, h0: 1, g: 9.8, mass: 1 },
          solution_steps: [
            { title: 'æ­¥éª¤1ï¼šåˆå§‹æ¡ä»¶', content: 'åˆé€Ÿåº¦æ–¹å‘å‘ä¸Š $$v_0 = 15\\text{ m/s}$$ï¼ŒåŠ é€Ÿåº¦å‘ä¸‹ $$a = -g = -9.8\\text{ m/s}^2$$' },
            { title: 'æ­¥éª¤2ï¼šæœ€é«˜ç‚¹', content: 'æœ€é«˜ç‚¹é€Ÿåº¦ä¸º0ï¼š$$v = v_0 - gt = 0$$<br>æ—¶é—´ï¼š$$t_{max} = \\frac{v_0}{g} = \\frac{15}{9.8} = 1.53\\text{ s}$$<br>é«˜åº¦ï¼š$$h_{max} = \\frac{v_0^2}{2g} = \\frac{225}{19.6} = 11.48\\text{ m}$$' },
            { title: 'æ­¥éª¤3ï¼šå›åˆ°åœ°é¢', content: 'æ€»æ—¶é—´ï¼š$$t_{total} = 2t_{max} = 3.06\\text{ s}$$<br>è½åœ°é€Ÿåº¦ï¼š$$v = -v_0 = -15\\text{ m/s}$$' }
          ]
        }
      },
      {
        description: 'åŒ€é€Ÿç›´çº¿',
        response: {
          animation_instructions: { type: 'uniform' },
          parameters: { vx: 10, vy: 0, x0: 0, y0: 5, mass: 1, duration: 8 },
          solution_steps: [
            { title: 'æ­¥éª¤1ï¼šåŒ€é€Ÿè¿åŠ¨ç‰¹å¾', content: 'é€Ÿåº¦æ’å®šï¼š$$v_x = 10\\text{ m/s}$$ï¼Œ$$v_y = 0\\text{ m/s}$$<br>åŠ é€Ÿåº¦ä¸ºé›¶ï¼š$$a = 0$$' },
            { title: 'æ­¥éª¤2ï¼šä½ç½®è®¡ç®—', content: 'ä½ç§»å…¬å¼ï¼š$$x = x_0 + v_x t = 0 + 10t = 10t\\text{ m}$$<br>$$y = y_0 + v_y t = 5 + 0 = 5\\text{ m}$$ï¼ˆä¿æŒä¸å˜ï¼‰' },
            { title: 'æ­¥éª¤3ï¼šè¿åŠ¨è§„å¾‹', content: 'åŒ€é€Ÿç›´çº¿è¿åŠ¨ï¼Œè½¨è¿¹ä¸ºæ°´å¹³ç›´çº¿ï¼Œ8ç§’åä½ç§» $$s = 80\\text{ m}$$' }
          ]
        }
      },
      {
  description: 'åŒ€åŠ é€Ÿç›´çº¿è¿åŠ¨',
  response: {
    animation_instructions: { type: 'uniform_acceleration' },
    parameters: { F: 50, mu: 0.2, mass: 10, g: 9.8, v0: 0, duration: 10 },
    solution_steps: [
      { title: 'æ­¥éª¤1: ç¡®å®šåŠ›', content: 'æ‹‰åŠ› F = 50 N, æ‘©æ“¦ç³»æ•° Î¼ = 0.2, è´¨é‡ m = 10 kg, g = 9.8 m/sÂ²' },
      { title: 'æ­¥éª¤2: è®¡ç®—æ”¯æ’‘åŠ›å’Œæ‘©æ“¦åŠ›', content: 'æ”¯æ’‘åŠ› Fn = mg = 10 Ã— 9.8 = 98 N<br>æ‘©æ“¦åŠ› f = Î¼ Fn = 0.2 Ã— 98 = 19.6 N' },
      { title: 'æ­¥éª¤3: è®¡ç®—åŠ é€Ÿåº¦', content: 'å‡€åŠ› F_net = F - f = 50 - 19.6 = 30.4 N<br>åŠ é€Ÿåº¦ a = F_net / m = 30.4 / 10 = 3.04 m/sÂ²' },
      { title: 'æ­¥éª¤4: è¿åŠ¨æ–¹ç¨‹', content: 'é€Ÿåº¦ v = v0 + a t = 0 + 3.04 t m/s<br>ä½ç§» s = 0.5 a tÂ² = 1.52 tÂ² m' }
    ]
  }
},
{
  description: 'åŒ€é€Ÿåœ†å‘¨è¿åŠ¨',
  response: {
    animation_instructions: { type: 'uniform_circular' },
    parameters: { radius: 5, omega: 2, mass: 1, mu: 0.5, g: 9.8, duration: 10 },
    solution_steps: [
      { title: 'æ­¥éª¤1: ç¡®å®šå‚æ•°', content: 'åŠå¾„ r = 5 m, è§’é€Ÿåº¦ Ï‰ = 2 rad/s, è´¨é‡ m = 1 kg, g = 9.8 m/sÂ²' },
      { title: 'æ­¥éª¤2: è®¡ç®—çº¿é€Ÿåº¦å’Œå‘å¿ƒåŠ›', content: 'çº¿é€Ÿåº¦ v = r Ï‰ = 5 Ã— 2 = 10 m/s<br>å‘å¿ƒåŠ› Fc = m vÂ² / r = 1 Ã— 100 / 5 = 20 N' },
      { title: 'æ­¥éª¤3: æ£€æŸ¥æ‘©æ“¦åŠ›', content: 'æ”¯æ’‘åŠ› Fn = mg = 9.8 N<br>æœ€å¤§æ‘©æ“¦ f_max = Î¼ Fn = 0.5 Ã— 9.8 = 4.9 N<br>(æ³¨: æ­¤ä¾‹ f_max < Fc, å¯èƒ½æ— æ³•ç»´æŒ, å®é™…éœ€è°ƒæ•´å‚æ•°)' },
      { title: 'æ­¥éª¤4: è¿åŠ¨è§„å¾‹', content: 'ä½ç½®: x = r cos(Ï‰ t), y = r sin(Ï‰ t)<br>é€Ÿåº¦æ–¹å‘åˆ‡å‘, åŠ é€Ÿåº¦å‘å¿ƒ' }
    ]
  }
}
    ];
    
    let currentTestIndex = 0;
    
    // ä¸‹ä¸€ä¸ªæµ‹è¯•
    document.getElementById('next-test-btn').onclick = () => {
      const test = testCases[currentTestIndex];
      log(`å¼€å§‹æµ‹è¯•: ${test.description}`);
      const apiResponse = test.response;
      currentAnimation = loadAnimationFromApi(canvas, apiResponse);
      
      // ä¿®æ”¹ï¼šåŠ è½½æ–°åŠ¨ç”»åï¼Œç«‹å³åŒæ­¥ checkbox çŠ¶æ€
      currentAnimation.config.showVelocityVectors = velocityCheckbox.checked;
      currentAnimation.config.showForceDiagram = forceCheckbox.checked;
      updatePhysicsPanel(currentAnimation);
      
      currentAnimation.play();
      
      // æ¸²æŸ“æ­¥éª¤
      renderSteps(apiResponse.solution_steps);
      
      currentTestIndex = (currentTestIndex + 1) % testCases.length;
    };
    
    // æ§åˆ¶æŒ‰é’®
    document.getElementById('play-btn').onclick = () => {
      if (currentAnimation) {
        if (currentAnimation.isEnded) {
          currentAnimation.reset();
          currentAnimation.play();
        } else {
          currentAnimation.play();
        }
      }
    };
    
    document.getElementById('pause-btn').onclick = () => currentAnimation?.pause();
    document.getElementById('reset-btn').onclick = () => currentAnimation?.reset();
    document.getElementById('export-btn').onclick = () => {
      if (currentAnimation) {
        const dataURL = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = `frame_${Date.now()}.png`;
        link.href = dataURL;
        link.click();
      }
    };
    
    document.getElementById('speed-select').onchange = function() {
      if (currentAnimation) {
        currentAnimation.config.fps = 60 * parseFloat(this.value);
        currentAnimation.dt = 1 / currentAnimation.config.fps;
      }
    };
    
    // æ–°å¢ï¼šcheckbox äº‹ä»¶
    velocityCheckbox.onchange = () => {
      if (currentAnimation) {
        currentAnimation.config.showVelocityVectors = velocityCheckbox.checked;
        updatePhysicsPanel(currentAnimation);  // æ›´æ–°é¢æ¿
      }
    };
    
    forceCheckbox.onchange = () => {
      if (currentAnimation) {
        currentAnimation.config.showForceDiagram = forceCheckbox.checked;
        updatePhysicsPanel(currentAnimation);  // æ›´æ–°é¢æ¿
      }
    };
    
  window.updatePhysicsPanel = function(animation) {
  if (!animation) return;
  const values = animation.getPhysicsValues();
  let html = '<strong>å®æ—¶ç‰©ç†é‡ï¼š</strong><ul>';
  
  if (animation.config.showVelocityVectors) {
    html += `
      <li><strong>é€Ÿåº¦çŸ¢é‡ï¼š</strong></li>
    `;
    // åŠ¨æ€æ£€æŸ¥ï¼šå¦‚æœæœ‰ vx/vyï¼ˆç›´çº¿æˆ–æŠ›ä½“è¿åŠ¨ï¼‰ï¼Œæ˜¾ç¤ºåˆ†é‡ï¼›å¦åˆ™æ˜¾ç¤ºåˆ‡å‘é€Ÿåº¦ï¼ˆåœ†å‘¨è¿åŠ¨ï¼‰
    if (values.vx !== undefined && values.vy !== undefined) {
      html += `
        <li>æ°´å¹³é€Ÿåº¦ (Vx): <span class="color-vx">${values.vx} m/s</span></li>
        <li>ç«–ç›´é€Ÿåº¦ (Vy): <span class="color-vy">${values.vy} m/s</span></li>
      `;
    } else if (values.v !== undefined) {
      html += `
        <li>åˆ‡å‘é€Ÿåº¦ (v): <span class="color-v">${values.v} m/s</span></li>
      `;
    }
    // æ€»æ˜¯æ˜¾ç¤ºåˆé€Ÿåº¦ vï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if (values.v !== undefined) {
      html += `
        <li>åˆé€Ÿåº¦ (V): <span class="color-v">${values.v} m/s</span></li>
      `;
    }
    // å¦‚æœæœ‰è§’é€Ÿåº¦ï¼Œæ˜¾ç¤ºï¼ˆé€‚ç”¨äºåœ†å‘¨è¿åŠ¨ï¼‰
    if (values.omega !== undefined) {
      html += `<li>è§’é€Ÿåº¦ (Ï‰): ${values.omega} rad/s</li>`;
    }
  }
  
  if (animation.config.showForceDiagram) {
    html += `
      <li><strong>å—åŠ›åˆ†æï¼š</strong></li>
      <li>é‡åŠ› (G): <span class="color-g">${values.gForce} N</span></li>
    `;
    // æ·»åŠ æ–°åŠ›ï¼ˆå·²æœ‰å…¼å®¹ï¼‰
    if (values.friction) html += `<li>æ‘©æ“¦åŠ› (f): <span class="color-f">${values.friction} N</span></li>`;
    if (values.tension) html += `<li>æ‹‰åŠ› (F): <span class="color-F">${values.tension} N</span></li>`;
    if (values.normal) html += `<li>æ”¯æ’‘åŠ› (Fn): <span class="color-Fn">${values.normal} N</span></li>`;
    if (values.centripetal) html += `<li>å‘å¿ƒåŠ› (Fc): <span class="color-Fc">${values.centripetal} N</span></li>`;
    if (values.omega) html += `<li>è§’é€Ÿåº¦ (Ï‰): ${values.omega} rad/s</li>`;
  }
  
  if (!animation.config.showVelocityVectors && !animation.config.showForceDiagram) {
    html += '<li>æ— é€‰ä¸­é€‰é¡¹</li>';
  }
  
  html += '</ul>';
  physicsPanel.innerHTML = html;
};
    
    function renderSteps(steps) {
      const panel = document.getElementById('steps-panel');
      panel.innerHTML = '<h3>è§£é¢˜æ­¥éª¤</h3>';
      steps.forEach((step, i) => {
        const div = document.createElement('div');
        div.className = 'step-item';
        div.innerHTML = `<h4>${step.title}</h4><p>${step.content}</p>`;
        panel.appendChild(div);
      });
      
      // è§¦å‘MathJaxæ¸²æŸ“
      if (window.MathJax) {
        MathJax.typesetPromise([panel]);
      }
    }
    
    function log(message) {
      const logDiv = document.createElement('div');
      logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      document.getElementById('log-container').appendChild(logDiv);
    }
  </script>
</body>
</html>